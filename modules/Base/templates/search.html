/*
<script language="javascript" type="text/javascript" 
            src="/fabweb/js/lib/firebug/firebug.js"></script>
*/          
<if test="{User::hasAccess('AdminBase')}">        /* Administrateur */
    <div class="titre">Base SantéPsy - Recherche - Accès administrateur</div>
</if>
<elseif test="{User::hasAccess('EditBase')}">     /* Membre du GIP */
    <div class="titre">Base SantéPsy - Recherche - Accès professionnel</div>
</elseif>
<else>
    <div class="titre">Base SantéPsy - Recherche - Accès public</div>
</else>

<div class="texte">

/*
<form class="form search" action="/base/search" method="get">
    Equation xapian : <textbox name="_equation" cols="50" rows="3" /><br />
    
    Réponses par page : 
    <select name="_max">
        <option selected="selected">10</option>
        <option>50</option>
        <option>100</option>
        <option>500</option>
    </select>

    Tri : 
    <select name="_sort" 
        src="{
                array
                (
                    array('code'=>'-', 'label'=>'docid décroissants'),
                    array('code'=>'+', 'label'=>'docid croissants'),
                    array('code'=>'%', 'label'=>'par pertinence'),
                )
            }" />
    <checkbox name="testdm" value="1" />testdm
    <br />
    <submit label="Rechercher" />
</form>

<hr style="clear: both; margin-top: 10em; margin-bottom: 2em;" />

*/
<form class="form search" action="/base/search" method="get">

    <div>
        <if test="{User::hasAccess('AdminBase')}">
            <textbox name="all" label="Recherche dans toute la base" rows="2" />
        </if>
        <else>
            <textbox name="all" label="Recherche dans toute la base" />
        </else>
    </div>
    
    <div>
        <textbox name="MotsCles" label="Descripteurs" />
        <p class="exemple"><a href="http://www.ascodocpsy.org/article.php3?id_article=691" target="_blank" title="Consulter le thesaurus SantéPsy (nouvelle fenêtre)">Consultez les descripteurs utilisés dans la base SantéPsy</a></p>
    </div>

    <div>
        <textbox name="Titres" label="Titre ou mots du titre" />
    </div>
    
    <div>
        <textbox name="Aut" label="Auteur" />
    </div>
    
    <div>
        <textbox name="Resu" label="Résumé" />
    </div>

    <div>
        <if test="{User::hasAccess('AdminBase') || User::hasAccess('EditBase')}">
            <checklist name="Type" label="Type de document" src="new TextTable($this->path.'../../tables/type.txt')" />
        </if>
        <else>
            <checklist name="Type" label="Type de document" src="new TextTable($this->path.'../../tables/public_type.txt')" />
        </else>
    </div>

    /* TODO : quickTable ? */
    <div>
        <checklist name="Liens" label="Texte intégral" src="array(array('code'=>'@has*', 'label'=>'Documents en ligne uniquement'))" />
    </div>

    <div>
        <select name="NatText" label="Nature du texte officiel" src="new TextTable($this->path.'../../tables/nattext.txt')" size="3" multiple="true" />
        <div class="infonatext">
            <p class="exemple">
                Pour sélectionner plusieurs types de texte officiel,
                appuyez sur la touche contrôle (Ctrl) et cliquez sur 
                les types souhaités. Procéder de même pour désélectionner.
            </p>
        </div>
    </div>

    <div>
        <textbox name="DateText" label="Date du texte officiel" class="smallbox"/>
        <p class="exemple">
            Format : AAAA-MM-JJ ou AAAA-MM ou AAAA
        </p>
    </div>

    <div>
        <textbox name="Rev" label="Titre du périodique" />
    </div>

	<div>		
        <textbox name="Numeros" label="Numéro (du périodique, du congrès, du texte officiel)" class="smallbox" />
    </div>

    <div test="{User::hasAccess('AdminBase') || User::hasAccess('EditBase')}">
        <textbox name="Vol" label="Numéro de volume" class="smallbox" />
    </div>
    
    <div>
        <checklist name="Dates" label="Date du document" src="new TextTable($this->path.'../../tables/date.txt')" />

        <div class="date">
			<textbox name="Dates" label="Autre date" />
		</div>
    </div>
    
    <div test="{User::hasAccess('AdminBase') || User::hasAccess('EditBase')}">
        <textbox name="Edit" label="Editeur" />
    </div>
    
    <div test="{User::hasAccess('AdminBase') || User::hasAccess('EditBase')}">
        <textbox name="Col" label="Collection" />
    </div>
    
    <div test="{User::hasAccess('AdminBase') || User::hasAccess('EditBase')}">
        <textbox name="IsbnIssn" label="ISBN, ISSN" />
        <p class="exemple">
            ISBN : 2-294-00377-2, ISSN : 4444-7564
        </p>
    </div>   
    
    <div test="{User::hasAccess('AdminBase')}">
        <textbox name="DipSpe" label="Spécialité du diplôme" />
    </div>
    
    <div test="{User::hasAccess('AdminBase') || User::hasAccess('EditBase')}">
        <textbox name="Loc" label="Localisation" class="smallbox" />
    </div>
    
    <div test="{User::hasAccess('AdminBase') || User::hasAccess('EditBase')}">
        <textbox name="ProdFich" label="Producteur" class="smallbox" />
        <p class="exemple">
            Producteur, localisation : format="asco5"
        </p>
    </div>
    
    <div test="{User::hasAccess('AdminBase') || User::hasAccess('EditBase')}">
        <checklist name="Statut" label="Statut de la notice" src="new TextTable($this->path.'../../tables/statut.txt')" />
    </div>

    <div test="{User::hasAccess('AdminBase')}">
        <textbox name="Creation" label="Date de création" />
    </div>

    <div test="{User::hasAccess('AdminBase')}">
        <textbox name="LastUpdate" label="Date de mise à jour" />
        <p class="exemple">
            Exemples : 2006*, 200612*, 20061215
        </p>
    </div>

    <div>
        <label class="text">Options</label>
        <div>
            Réponses par page : 
            <select name="_max">
                <option selected="selected">10</option>
                <option>50</option>
                <option>100</option>
                <option>500</option>
            </select>
        
            Ordre de tri : 
            <select name="_sort" 
                src="{
                        array
                        (
                            array('code'=>'%', 'label'=>'par pertinence'),
                            array('code'=>'-', 'label'=>'docid décroissants'),
                            array('code'=>'+', 'label'=>'docid croissants'),
                        )
                    }" />
        </div>
    </div>    
    <div class="buttons">
        <submit label="Rechercher" class="spip_bouton" />
    </div>
    
</form>

<form class="form reset">
    <div class="buttons">
        <submit label="Effacer tout" class="reset spip_bouton" />
    </div>
</form>

</div>
<script type="text/javascript">

jQuery(document).ready(
    function()
    \{
        // Affichage conditionnel de critères
        var textof=jQuery('input[@value="Texte officiel"]');
        if (! textof.is(':checked'))
        \{
            jQuery('#DateText').parent().hide();
            jQuery('#NatText').parent().hide();
        \};
        
        textof.click(function()
        \{
            jQuery('#DateText').parent().slideToggle('normal');
            jQuery('#NatText').parent().slideToggle('normal');
        \});
        
        // Critères dont la liste des valeurs de la base est disponible
        jQuery('#MotsCles').autocomplete
        (
            '{Routing::linkFor("/base/lookup")}?table=motscles&amp;value=%s',
            \{
                asValue: true
            \}
        );
        
        jQuery('#Aut').autocomplete
        (
            '{Routing::linkFor("/base/lookup")}?table=auteurs&amp;value=%s',
            \{
                asValue: true
            \}
        );
        jQuery('#Rev').autocomplete
        (
            '{Routing::linkFor("/base/lookup")}?table=revues&amp;value=%s',
            \{
                asValue: true
            \}
        );
        jQuery('#Edit').autocomplete
        (
            '{Routing::linkFor("/base/lookup")}?table=editeurs&amp;value=%s',
            \{
            \}
        );
        jQuery('#Col').autocomplete
        (
            '{Routing::linkFor("/base/lookup")}?table=collections&amp;value=%s',
            \{
            \}
        );

        jQuery('#Loc').autocomplete('{Routing::linkFor("/base/lookup")}?table=localisations&amp;value=%s');
        jQuery('#ProdFich').autocomplete('{Routing::linkFor("/base/lookup")}?table=producteurs&amp;value=%s');
        
        jQuery('#DipSpe').autocomplete
        (
            '{Routing::linkFor("/base/lookup")}?table=diplomes&amp;value=%s',
            \{
            \}
        );

    \}
);
</script>