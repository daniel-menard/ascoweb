<if test="{User::hasAccess('AdminBase')}">        /* Administrateur */
    <div class="titre">Base SantéPsy - Visualisation - Accès administrateur</div>
</if>
<elseif test="{User::hasAccess('EditBase')}">     /* Membre du GIP */
    <div class="titre">Base SantéPsy - Visualisation - Accès professionnel</div>
</elseif>
<else>
    <div class="titre">Base SantéPsy - Visualisation - Accès public</div>
</else>

<div class="texte">

<p test="{User::hasAccess('AdminBase') || User::hasAccess('EditBase')}">
    Equation : <code>{$this->equation}</code><br />
    Réponses : <code>{$this->selection->count()}</code>
</p>

    <ul class="fulllist">
        <loop on="{$this->selection}" as="$rank, $record">
            <li class="record">

                /* Boutons supplémentaires pour les membres du GIP et les administrateurs (actions à effectuer la notice) */
	            <if test="{User::hasAccess('AdminBase') || User::hasAccess('EditBase')}">
	                <if test="{!Config::get('incart',false)}">
                        <a class="addtocart" href="/AscoCart/Add?item=$REF" title="Ajouter au panier"><span>Ajouter au panier</span></a>
	                </if>
	                <else>
                        <a class="removefromcart" href="/AscoCart/Remove?item=$REF" title="Supprimer du panier"><span>Supprimer du panier</span></a>
	                </else>
	            </if>                

                <a test="{$this->hasEditRight()}" class="loadrecord" href="/Base/Load?REF=$REF" title="Modifier la notice"><span>Modifier la notice</span></a>

                /* Affiche les informations appropriées en fonction du type de document et des drois utilisateurs */
                <switch test="{strtolower($Type)}">
                
                    <case test="article">
                        <TDTA />
                        <row label="Source">$Rev<Localisation /><opt> $Presentation</opt><opt>, vol $Vol</opt><opt>, n°$Num</opt>, p. $PdPf</row>
                        <Notes />
                        <MTCNR />
                        <opt><row test="{User::hasAccess('AdminBase') || User::hasAccess('EditBase')}" label="Producteur">$ProdFich</row></opt>
                    </case>
                    
                    <case test="congrès">
                        <TDTA />
                        <opt><row label="Congrès"><opt>$CongrTit, </opt><opt>$CongrDat, </opt><opt>n°$CongrNum, </opt><opt>$CongrLie</opt></row></opt>
                        <opt><row label="Source"><opt>$Lieu : </opt><opt>$Edit, </opt><opt>$Reed, </opt>$Page</row></opt>
                        <opt><row label="Collection">$Col</row></opt>
                        <Notes />
                        <MTCNR />
                        <Isbn />
                        <if test="{User::hasAccess('AdminBase') || User::hasAccess('EditBase')}">
                            <opt><row label="Localisation">$Loc</row></opt>
                            <opt><row label="Producteur">$ProdFich</row></opt>
                        </if>
                    </case>
                    
                    <case test="livre">
                        <TDTA />
                        <opt><row label="Source"><opt>$Lieu : </opt><opt>$Edit, </opt><opt>$Reed, </opt>$Page</row></opt>
                        <opt><row label="Collection">$Col</row></opt>
                        <Notes />
                        <MTCNR />
                        <Isbn />
                        <if test="{User::hasAccess('AdminBase') || User::hasAccess('EditBase')}">
                            <opt><row label="Localisation">$Loc</row></opt>
                            <opt><row label="Producteur">$ProdFich</row></opt>
                        </if>
                    </case>
                    
                    <case test="{strtolower($Type)=='mémoire' || strtolower($Type)=='thèse'}">
                        <TDTA />
                        <if test="{User::hasAccess('AdminBase') || User::hasAccess('EditBase')}">
                            <opt><row>$DipSpe</row></opt>
                            <opt><row label="Source"><opt>$Lieu, </opt><opt>$Edit, </opt>$Page</row></opt>
                        </if>
                        <else>
                            <opt><row label="Thèse"><opt>$DipSpe, </opt><opt>$Lieu, </opt><opt>$Edit, </opt>$Page</row></opt>
                        </else>
                        <Notes />
                        <MTCNR />
                        <if test="{User::hasAccess('AdminBase') || User::hasAccess('EditBase')}">
                            <opt><row label="Localisation">$Loc</row></opt>
                            <opt><row label="Producteur">$ProdFich</row></opt>
                        </if>
                    </case>
                    
                    <case test="périodique">
                        <div class="row"><div>$Type<opt>, $ViePerio</opt></div></div>
                        <div class="row"><div>$Rev<opt> $Presentation</opt><opt>, {implode(' / ',(array)$IsbnIssn)}</opt></div></div>
                        <opt><row label="Localisation">$EtatCol</row></opt>
                        <Notes />
                    </case>
                    
                    <case test="rapport">
                        <TDTA />
                        <opt><row label="Source"><opt>$Lieu : </opt><opt>$Edit, </opt><opt>$Reed, </opt><opt>$PageEdit</opt></row></opt>                        
                        <opt><row label="Source">$Rev<Localisation /><opt> $Presentation</opt><opt>, vol $Vol</opt><opt>, n°$Num</opt><opt>, $PageRev</opt></row></opt>
                        <opt><row label="Collection">$Col</row></opt>
                        <Notes />
                        <MTCNR />
                        <Isbn />
                        <opt><row test="{User::hasAccess('AdminBase') || User::hasAccess('EditBase')}" label="Producteur">$ProdFich</row></opt>
                    </case>
                    
                    <case test="texte officiel">
                        <row>$Type</row>
                        <opt><row label="Titre"><Tit /><opt> ; $Annexe</opt></row></opt>
                        <opt><row test="{! (User::hasAccess('AdminBase') || User::hasAccess('EditBase'))}" label="Source">$Rev du $DatePub, n°$Num</row></opt>
                        <opt><row test="{User::hasAccess('AdminBase') || User::hasAccess('EditBase')}" label="Source">$Rev<opt>, n°$Num</opt><opt> du $DatePub</opt></row></opt>
                        <MTCNR />
                        <opt><row test="{User::hasAccess('AdminBase') || User::hasAccess('EditBase')}" label="Producteur">$ProdFich</row></opt>
                    </case>
                </switch>
                
                <opt><row test="{User::hasAccess('AdminBase')}" label="Mise à jour">$LastUpdate<opt> par $LastAuthor</opt></row></opt>
            </li>
        </loop>
    </ul>
</div>

<script>
function init()
\{
    // Lien "ajouter cette notice au caddie"
    jQuery('a.addtocart').click(function(e)
    \{
        jQuery.post(this.href);
        jQuery(this.parentNode).addClass('incart'); // parent=le li.record englobant
        jQuery(this).remove();
        return false;
    \});

	// Lien "Supprimer la notice du panier"
    jQuery('a.removefromcart').click(function()
    \{
        jQuery.post(jQuery(this).attr('href'));
        jQuery(this.parentNode).css('background-color','#FFFFC0').fadeOut(400, function()\{jQuery(this).remove().next().remove()\});
        return false;
    \});
\}

jQuery('document').ready(init);
</script>