<template match="//export" fields=""
><header fields="$fields" />
<loop on="$this->selection" as="$record"><record fields="$fields" />
</loop></template>

<template match="//header" fields=""
    ><loop on="$fields" as="$i,$field">{$i==0?'':"\t"}{strtoupper($field)}</loop>
</template>

<template match="//record" fields=""
    ><loop on="$fields" as="$i,$field">{$i==0?'':"\t"}{
        Utils::csvQuote
        (
            is_array($this->selection[$field])
            ?
                (is_array(Config::get("formats.$format.sep"))
                ? 
                    ( Config::get("formats.$format.sep.$field") 
                    ? implode(Config::get("formats.$format.sep.$field"),$this->selection[$field])
                    : implode(Config::get("formats.$format.sep.default"),$this->selection[$field])
                    )
                : implode(Config::get("formats.$format.sep"),$this->selection[$field])
                )
            : $this->selection[$field]
        )
    }</loop>
</template>