/* Template pour factoriser l'affichage : pour presque tous les types de doc, il faut afficher
$Type, $Date, $Tit, $Aut : permet de le faire en une seule ligne */
<template match="//TDTA">
    <row >$Type, $Date</row>
    <row label="Titre">$TIT</row>
    <opt><row label="Auteur(s)">$AUT</row></opt>
</template>


/* Template pour afficher un <label> et une <div class="row"> dans une autre <div class="field"> */
<template match="//row" label="" class="" value="" test="">
    <div test="$test" class="row $class">
        <label test="'$label'" class="field $class">$label</label>
        <div class="field $class">
            {select('string(@value)')}{select('./node()')}{select('@*')}
        </div>
    </div>
</template>



<if test="User::hasAccess('AdminBase')">        /* Administrateur */
    <h1>Base documentaire - Recherche - Accès administrateur</h1>
</if>
<elseif test="User::hasAccess('EditBase')">     /* Membre du GIP */
    <h1>Base documentaire - Recherche - Accès membre du GIP</h1>
</elseif>
<else>
    <h1>Base documentaire - Recherche - Accès public</h1>
</else>

/* Afficher le nombre de réponses obtenues ? */

<h2>Liste des réponses obtenues</h2>
<p>Equation : <code>$equation</code></p>
<p><strong>Les documents sont triés par date et par type, les périodiques par ordre alphabétique.</strong></p>


/* Boutons supplémentaires pour les membres du GIP's et les admin (actions à effectuer sur les notices sélectionnées) */
<form if="User::hasAccess('AdminBase') || User::hasAccess('EditBase')" action="/base/addToCart" method="post" name="answers">

    <div test="User::hasAccess('AdminBase') || User::hasAccess('EditBase')" class="buttons">
        <button name="btnselect" label="Tout sélectionner" onclick="selectAll(true)" />
        <button name="btnunselect" label="Tout désélectionner" onclick="selectAll(false)" />
        <submit name="btnadd" label="Ajouter les notices au panier" />
    </div>    

    <hr />

    <ul class="shortlist">
        <loop on="$selection" as="$rank, $record">
            <li class="record">
                <checkbox test="User::hasAccess('AdminBase') || User::hasAccess('EditBase')" name="ART" value="$REF" />
                
                <a class="fullrecord" href="show?REF=$REF" title="Voir la notice complète"><span>Voir la notice complète</span></a>
                
                <if test="User::hasAccess('AdminBase') || $ShowModifyBtn">
                    <a class="loadrecord" href="load?REF=$REF" title="Modifier la notice"><span>Modifier la notice</span></a>
                </if>
                
                /* affiche les informations appropriées en fonction du type de document et des drois utilisateurs */
                <switch test="$type">
                
                    <case test="'Article'">        
                        <TDTA />
                        <row test="! (User::hasAccess('AdminBase') || User::hasAccess('EditBase'))" label="Périodique">$REV<opt>, vol $VOL</opt><opt>, n°$NUM</opt>, p. $PDPF</row>
                        <row test="User::hasAccess('AdminBase') || User::hasAccess('EditBase')" label="Périodique">$REV<opt> $LOCALISATION</opt><opt> $PRESENTATION</opt><opt>, vol $VOL</opt><opt>, n°$NUM</opt>, p. $PDPF</row>
                    </case>
                    
                    <case test="'Congrès'">
                        <TDTA />
                        <opt><row label="Congrès"><opt>$CONGRTIT, </opt><opt>$CONGRDAT, </opt><opt>n°$CONGRNUM, </opt><opt>$CONGRLIE, </opt><opt>$LIEU : </opt><opt>$EDIT, </opt><opt>$REED, </opt>$PAGE</row></opt>
                        <opt><row test="User::hasAccess('AdminBase') || User::hasAccess('EditBase')" label="Localisation">$LOC</row></opt>
                    </case>
                    
                    <case test="'Livre'">
                        <TDTA />
                        <opt><row label="Editeur"><opt>$LIEU : </opt><opt>$EDIT, </opt><opt>$REED, </opt>$PAGE</row></opt>
                        <opt><row test="User::hasAccess('AdminBase') || User::hasAccess('EditBase')" label="Localisation">$LOC</row></opt>
                    </case>
                    
                    <case test="$type=='Mémoire' || $type=='Thèse'">
                        <TDTA />
                        <opt><row><opt>$DIPSPE, </opt><opt>$LIEU, </opt><opt>$EDIT, </opt>$PAGE</row></opt>
                        <opt><row test="User::hasAccess('AdminBase') || User::hasAccess('EditBase')" label="Localisation">$LOC</row></opt>
                    </case>
                    
                    <case test="'Périodique'">
                        <row>$TYPE<opt>, $VIEPERIO</opt></row>
                        <row>$REV<opt> $PRESENTATION</opt><opt>, $ISBNISSN</opt></row>
                        <opt><row>$NOTES</row></opt>
                    </case>
                    
                    <case test="'Rapport'">
                        <TDTA />
                        <opt><row label="Editeur"><opt>$LIEU : </opt><opt>$EDIT, </opt><opt>$REED, </opt>$PAGEEDIT</row></opt>
                        <opt><row test="! (User::hasAccess('AdminBase') || User::hasAccess('EditBase'))" label="Périodique"><opt>$REV</opt><opt>, vol $VOL</opt><opt>, n°$NUM</opt><opt>, $PAGEREV</opt></row></opt>
                        <opt><row test="User::hasAccess('AdminBase') || User::hasAccess('EditBase')" label="Périodique"><opt>$REV</opt><opt> $LOCALISATION</opt><opt> $PRESENTATION</opt><opt>, vol $VOL</opt><opt>, n°$NUM</opt>, $PAGEREV</row></opt>
                    </case>
                    
                    <case test="'Texte officiel'">
                        <row>$Type</row>
                        <row test="! (User::hasAccess('AdminBase') || User::hasAccess('EditBase'))" label="Titre">$TIT<opt> / $ANNEXE</opt></row>
                        <row test="User::hasAccess('EditBase')" label="Titre">$TIT<opt> ; $ANNEXE</opt></row>
                        <opt><row test="User::hasAccess('AdminBase') || User::hasAccess('EditBase')" label="Périodique">$REV<opt> du $DATEPUB</opt></row></opt>
                    </case>
                    
                </switch>
            </li>
            <hr />
        </loop>
    </ul>

    /* Répétition des boutons du dessus */
    <div test="User::hasAccess('AdminBase') || User::hasAccess('EditBase')" class="buttons">
        <button name="btnselect" label="Tout sélectionner" onclick="selectAll(true)" />
        <button name="btnunselect" label="Tout désélectionner" onclick="selectAll(false)" />
        <submit name="btnadd" label="Ajouter les notices au panier" />
    </div>    

</form>

<p class="top">
    <a href="#">Haut de page</a>
</p>